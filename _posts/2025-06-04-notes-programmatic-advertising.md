---
layout: post
title: 「程序化广告—个性化精准投放实用手册」笔记
date: 2020-04-19
categories: AdTech
description: Overview of Programmatic Advertising
---


<br>

#### 目录

- [参与者](#参与者)
  - [需求方](#需求方)
  - [需求方服务](#需求方服务)
  - [流量供应方](#流量供应方)
  - [流量供应方服务](#流量供应方服务)
  - [广告服务与数据管理](#广告服务与数据管理)

- [交易模式](#交易模式)
  - [交易模式的类型](#交易模式的类型)
  - [交易模式的对比](#交易模式的对比)
  - [交易模式的价值](#交易模式的价值)

- [相关技术问题](#相关技术问题)

  - [RTB 竞价逻辑](#RTB竞价逻辑)
  - [流量对接](#流量对接)
  - [用户识别与 ID 映射](#用户识别与ID映射)
  - [程序化创意](#程序化创意)
  - [用户数据中心](#用户数据中心)

- [总结与展望](#总结与展望)

  - [买卖双方的需求和痛点](#买卖双方的需求和痛点)

---

#### 参与者

##### 需求方

即广告主，主要有两种类型，一种是效果类广告需求方，一种是品牌类广告需求方

##### 需求方服务

- 需求方平台（Demand-Side Platform，DSP）

  一个为需求方提供的实时竞价投放的平台，广告主可以再 DSP 上管理广告投放策略、预算、出价、创意等。DSP 通过算法自动优化拖放效果并提供数据广告。

  通俗的理解：广告主是要买菜的，Ad Exchange 是一个菜市场，DSP 就是一个熟悉这个菜市场的带路人，一个好的 DSP 能够带你到合适的摊位（流量主、媒体），当一个新菜刚出的时候（用户访问媒体带来流量，进而带来广告需求），DSP 告诉你用什么价格买最合适（因为有其他广告主同时是也准备买）

  - 进入者分析
    - 可能是广告代理公司或广告网盟（Ad Network），他们掌握了大量的广告主资源
    - Ad Exchange 或 SPP 公司，如百度阿里腾讯等
    - 大预算广告主自己组建 DSP，如携程、网易等
    - 纯技术出身的公司
  - DSP 分类
    - 根据 DSP 对接的资源情况和服务对象可以分为纯 web 端 DSP、移动 DSP、跨屏 DSP
    - 根据 DSP 所有者可以分为第三方 DSP、大型媒体私有 DSP、大型广告主私有 DSP
  - DSP 关注的点
    - 流量资源：即流量的质量、规模和价格

##### 流量供应方

两种类型，一种是媒体网站或 APP；另外一种是广告网盟（Ad Network），可以理解为媒体代理公司，为广告主采购媒体方流量。

##### 流量方服务

- 供应方平台（Supply-Side Platform，SSP）

  理论上 SSP 对接媒体，然后再对接近 Ad Exchange。但现在 SSP 功能和 Ad Exchange 功能基本重合，DSP 通过 API 接口对接 SSP 或 Ad Exchange，实时竞价购买流量

- 广告交易平台（Ad Exchange，AdX）

  - 进入者分析
    - 大型媒体自建 AdX/SSP，腾讯、优酷等
    - 广告网盟转型 AdX/SSP，百度、阿里等
    - DSP 布局 AdX/SSP
  - AdX/SSP 分类
    - 第三方开放 AdX/SSP，聚合各类中大小媒体的流量进行变现
    - 大型媒体私有 AdX/SSP，如优酷 AdX、爱奇艺 AdX、网易 AdX、新浪 AdX 等
  - AdX/SSP 关注的点
    - 填充率：即保证手上的流量能被卖出去，有广告投放

##### 广告服务与数据管理

广告服务（Ad Serving）是广告投放平台之外的第三方广告投放服务提供方，不提供竞价服务，只是帮助广告主投放广告、衡量并优化广告效果。包括检测分析、程序化创意、广告验证等服务。

数据管理则是为广告主提供数据收集、清洗及生成标签等服务，提高数据使用效率，优化投放效果。

- 程序化创意平台（Programmatic Creative Platform，PCP）
  - 通过技术生成海量创意，利用算法和数据对不同受众动态进行创意优化（千人前面），比如根据实时反馈更新广告的创意（模板、元素属性、元素组合等）
- 广告验证平台（Ad Verification Platform）
  - 为品牌广告服务，提供品牌安全、反作弊、可视度、无效流量验证等服务
- 数据管理平台（Data Management Platform，DMP）
  - 提供人群标签管理、受众精准定向、用户画像等服务
- 检测分析平台（Measurement & Analytics Platform）
  - 提供广告投放数据监测分析服务


<br>

#### 交易模式

##### 交易模式类型

- 实时竞价（Real-Time Bidding，**RTB**）

  广告主可以在 RTB 交易市场自由挑选媒体资源，竞价购买目标人群。媒体可以介入 RTB 交易市场，实现流量变现。RTB 交易市场可以分为公有和私有

  - 公开竞价（Open RTB，Open Auction）

    - RTB 按照 CPM 出价，一般使用（广义）第二高价，价高者得，按次高价结算。通常会先设定好一个底价，DSP 出价必须高于这个底价才有资格参与竞价。

    - 为了避免广告位出现空白，还有一类默认广告/打底广告，一般是一个广告位没人竞价使用默认填充的广告，这类广告价格最便宜。

  - 私有竞价（Private RTB，Private Auction， **PA**）

    媒体为了保证广告质量，只邀请部分广告主竞价购买。通常私有竞价媒体质量更有，价格更高。

- 程序化直接交易（Programmatic Direct Buying，**PDB**）

  一种 non-RTB 的方式，广告主和媒体按照双方约定，绕过竞价直接一对一交易。品牌广告主通常会选择这种模式。这种广告的展现优先级最高，主要有首选交易和程序化保量两种模式

  - 程序化保量（Programmatic Guaranteed Buying，**PGB**）

    保价保量。媒体按照与广告主约定的 CPM 价格、广告位、**流量数量**进行投放。PGB 流程如下图

  - 首选交易（Preferred Deals，**PD**）

    保价不保量。媒体按照与广告主约定的 CPM 价格、广告位进行投放。

  两者的区别是：首选交易可以只买想要的流量，而程序化保量需要购买前协商好流量数量（不管是不是广告想要的都得展示，基本没办法做到百分百都是广告主想要的流量）

- 头部竞价（Header Bidding）

  头部竞价实际上就是绕过了 Ad Exchange 的 RTB 竞价，媒体在其页面中嵌入多个广告主的相关代码，当有广告需求时同时向多个广告主发送请求，广告主们开始竞价，最后展示最高价的广告。

  经过头部竞价剩余的流量才会进入 Ad Exchange 进行售卖。这就是为什么叫头部竞价，因为竞价的是头部流量。

##### 交易模式的对比

<!--START figure-->
<div class="figure">
  <a href="/assets/Machine%20Learning/notes-programmatic-01.jfif" data-lightbox="transaction_modes">
    <img src="/assets/Machine%20Learning/notes-programmatic-01.jfif" width="60%" alt="transaction_modes" referrerPolicy="no-referrer"/>
  </a>
</div>
<!--END figure-->

##### 交易模式的价值

- RTB：资源整合、实时竞价、受众购买
- PA：与 RTB 相似均为剩余流量，但是 PA 的剩余流量更为优质
- PD：PD 相比 RTB 和 PA，流量更为优质，价格固定，受众购买
- PDB：保留了传统的下单排期、固定价格，同时具备了优质流量程序化投放的特点

- PDB 与 RTB

  PDB 价格较高，一般适用于大型品牌广告主，可以优**先采买优质流量、确保排期**；但是有限的订单流量可能无法满足广告主的投放 KPI

  RTB 可以随时挑选流量，但是**无法保障购买的库存流量的价格、质量以及展示量级**。

  可以同时结合 RTB 和 PDB 进行投放。

<br>

#### 广告效果

##### 广告效果定义与层次

- 定义

  狭义：通过广告投放带来的直接经济利益

  广义：通过广告传播影响受众对品牌的认知、心理、态度等，由此带来的直接或简介的广告效益。

- 层次

  `传播效果 -> 心理效果 -> 行为效果 `

##### 广告效果的评估

- 三个方面
  - 广告效果：衡量用户活跃度、对广告的接受度
  - 成本收益：衡量投放过程中的成本、收益
  - 投放保障：恒联广告投放的真实性和安全性（用于保障广告效果和成本收益）
- 效果指标
  - ROI，最终目的都是 ROI，但是 ROI 具有滞后性，需要一段时间的验证
  - 点击量、转化量、登录量
  - DAU/WAU/MAU、平均付费金额、留存率、活跃率、付费率等
- 品牌指标

<br>

#### 相关技术问题

##### RTB 竞价逻辑

- RTB 竞价流程

    1. （用户方）用户 A 访问带有广告位的媒体页面

    2. （媒体方）媒体将用户 A 的广告展示请求发给 AdX/SSP，触发 AdX/SSP 竞价

    3. （AdX/SSP）根据 User ID 通过<u>用户数据中心</u>查询 A 的相关信息（性别、年龄等）

    4. （AdX/SSP） <u>竞价发起服务</u>组织一次竞价，向 DSP 平台发送竞价请求（Bid Request），并传输用户 A 的相关信息、广告位信息（页面 URL、广告位大小、位置、类型等）

    5. （DSP）<u>竞价监听服务</u>受到来自 AdX/SSP 的竞价请求后，将请求信息发给竞价引擎

    6. （DSP）竞价引擎根据 UserID 想用户数据中心查询用户相关信息

    7. （DSP）竞价引擎将用户数据与投放需求进行匹配，决定是否参与出价以及 CPM 出价多少合适

    8. （DSP）如果决定参与竞价，则向 AdX 发出响应（报价、AdTag）。（这个过程被限定在一定的时间内完成，如 100ms，超时视为自动放弃）

    9. （AdX/SSP）等待 100ms 后，<u>竞价决策服务</u>使用广义第二高价确定赢得这次竞价的 DSP，向媒体方发送赢家 DSP 以及其报价和 Ad Tag，向赢家 DSP 发送竞价成功的消息

    10. （DSP）收到来自 AdX/SSP 的竞价成功信息，同时需要响应来自媒体方的广告物料请求

    11. （媒体方）收到 AdX/SSP 的竞价结果后向赢家 DSP 请求广告物料进行展示。（也有部分情况是 DSP 事先将广告物料放在 AdX/SSP 上，这种情况下媒体直接向 AdX/SSP 请求广告物料）

    12. （用户）看到广告

    RTB 竞价整体流程如下

	<!--START figure-->
	<div class="figure">
	  <a href="/assets/Machine%20Learning/notes-programmatic-02.jfif" data-lightbox="rtb_procedure">
		<img src="/assets/Machine%20Learning/notes-programmatic-02.jfif" width="70%" alt="rtb_procedure" referrerPolicy="no-referrer"/>
	  </a>
	</div>
	<!--END figure-->

- 竞价结算规则：广义第二高价。关于竞价广告的定价策略，可以参考 [竞价广告定价策略与实现](<http://freewill.top/2019/07/12/AD-RS-3/>)

- AdX/SSP 底价规则：固定底价、双重底价

- **DSP 内部竞价排名**

    DSP 内部多个广告主可能同时会对一个流量进行竞价，DSP 需要在满足竞价条件的广告主中，选出 eCPM 最高的广告主，以该价格（加1分钱）出价。eCPM 可以进行以下分解
    $$
    eCPM = 1000 \times pCTR \times CPC
    = 1000 \times pCTR \times pCVR \times CPA
    $$

    - 如果 DSP 按照 CPM 与广告主结算，则广告主需要自己对 CTR 进行估计，进而给出合理的 CPM
    - 如果 DSP 按照 CPC 或 CPA 结算，则 CTR 预估需要由 DSP 来完成

    关于 DSP 广告策略，可以参考 [美团 DSP 广告策略实践](<https://tech.meituan.com/2017/05/05/mt-dsp.html>)

##### 流量对接

- DSP 与 AdX/SSP 对接

- Trading Desk 与 DSP 对接

- PDB 对接

  PDB 是保量保价的，主要有两种模式

  - 一种是 100% 采购模式，这种模式比较简单，就是满足 PDB 约定中的流量即可，但这里面的流量受众是广告主不能选择的，即存在一部分流量不是广告主的目标流量，流量质量较差

  - 另一种是退量模式，DSP 和广告主之间约定一个需求量和退量比例，广告主可以在流量中挑选想要的流量，对于不想要的流量可以退掉（不付钱）。这样广告主得到了更优质的流量。对于 DSP 的要求较高，DSP 需要控制好退量的比例，如果退量过高，则可能达不到约定的需求量，如果退量过低，则可能超出广告主的预算。

    因此 DSP 需要实时计算退量比例，如果达到比例已经达到约定数值，即使是非目标流量也需要进行曝光。

##### 用户识别与 ID 映射

- 用户识别：

  - PC 端使用 cookie 作为用户的标识，但是存在生命周期短（cookies 被清理）、同一用户用不同浏览器也会生成不同 cookie、不同域名之间的 cookie 无法共享数据（除非做 cookie 映射）

  - 移动端相对 PC 更加稳定，安卓使用 Android-ID 或 IMEI 号，IOS 使用 IDFA 号作为标识。

- cookie 映射

  - 程序化广告中每个参与者（媒体网站、AdX/SSP、DSP、广告主网站）都需要为 PC 用户打上 cookie，而不同参与者 cookie 命名规则不同，因此需要做 cookie 映射把同一个用户不同 cookie 串联起来
  - 主要有以下几种 cookie 映射
    - AdX 与 DSP 的映射
    - DSP 与 DMP 的映射
    - DSP 与广告服务平台的映射
    - AdX 与 DMP 的映射

##### 程序化创意

- 动态创意优化（Dynamic Creative Optimization，DCO）
  1. （PCP） 对接广告主商品信息（名称、价格、页面等），商品信息入库
  2. （PCP）平台调用商品信息和用户信息设置动态创意规则
  3. （PCP） 将设置好的动态创意规则生成创意代码 Ad Tag，发送到 DSP
  4. （DSP） 竞价成功后发送 Ad Tag 到媒体
  5. （媒体）根据 Ad Tag 和用户 ID 向 PCP 请求创意广告内容
  6. （PCP 推荐引擎）根据用户 ID 得到用户信息，根据用户信息和商品规则得到要展示的商品
  7. （PCP 创意渲染服务）根据商品信息、Ad Tag 对应样式生成个性化创意，发送给媒体

##### 用户数据中心

- DMP 原理
  - 将来自不同参与者的用户数据接进来，包括媒体埋点的数据、广告投放的业务数据（如曝光、点击次数等）、第三方 DMP 数据等
  - 将不同来源的数据通过 cookie 映射的方式串联起来
  - 批处理、清洗、过滤异常数据
  - 算法结合标签规则用机器学习和数据挖掘将数据标签化，返回给标签管理平台
  - 标签管理平台通过输出接口同步到各应用平台（DSP、PCP、AdX/SSP 等）
- 用户画像逻辑
  - 用户标签包括：
    - 用户识别号（cookie、设备 ID）
    - 终端设备（浏览器、操作系统、语言、设备型号等）
    - 地点（国家、省份、城市、城所、移动轨迹）
    - 时间（发生时间、持续时间、间隔时间等）
    - 行为（行为类型：搜索、购买、登录、浏览、点击等、行为次数、行为介质）
- Look Alike 原理
  - 本质上就是 User-based 协同过滤

<br>

#### 总结与展望

##### 买卖双方的需求和痛点

- 流量需求方（广告主）
  - 投放计划
    - 如何制定有效的 KPI
    - 如何分析受众
    - 如何预估投放质量
  - 策略制定
    - 如何找到合适的媒体资源
    - 如何找到精确的人群数据
    - 如何设计创意内容信息
    - 如何出价
  - 活动执行
    - 如何根据每个用户特点设置最佳策略组合
    - 如何保障品牌安全
    - 如何高效率地完成上述操作
  - 优化调整
    - 如何分析数据
    - 如何及时过滤无效流量
    - 如何输出数据洞察报告
- 流量供给方（媒体）
  - 媒介策划
    - 如何制定有效的 KPI
    - 如何设计广告位类型
    - 如何预估售卖质量
  - 售卖策略
    - 如何合理对流量分层
    - 如何为各类榴莲固定架
  - 交易策略
    - 如何评估各家广告投放平台和广告主的质量
  - 优化调整
    - 如何提升填充率和 eCPM
    - 如何平衡广告主利益、用户体验及媒体自身形象
    - 如何及时发现作弊流量

<br><br>
